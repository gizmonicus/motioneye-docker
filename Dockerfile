FROM debian:latest

# Setup repositories for prereqs
RUN echo "deb http://www.deb-multimedia.org jessie main non-free" >> /etc/apt/sources.list && \
    apt-get -y update && \
    apt-get -y --force-yes install deb-multimedia-keyring && \
    apt-get -y update

# Install prerequisite software
RUN apt-get -y install \
    motion \
    ffmpeg \
    v4l-utils \
    python-pip \
    python-dev \
    libssl-dev \
    libcurl4-openssl-dev \
    libjpeg-dev && \
    apt-get clean

RUN pip install motioneye

# Create media config dirs. These need to be persistent to save configuration 
# and images/videos generated by motion processes.
RUN mkdir -p /etc/motioneye /var/lib/motioneye
VOLUME [ "/etc/motioneye", "/var/lib/motioneye" ]
EXPOSE 8765
CMD /usr/local/bin/meyectl startserver
